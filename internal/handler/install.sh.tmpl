#!/bin/bash
# Drop Client Installer
# Auto-generated install script

set -e

BASE_URL="{{.BaseURL}}"
INSTALL_DIR="$HOME/.local/bin"
BINARY_NAME="drop"

# Detect platform
detect_platform() {
    local os arch
    
    case "$(uname -s)" in
        Linux*)     os="linux" ;;
        Darwin*)    os="darwin" ;;
        CYGWIN*|MINGW32*|MSYS*|MINGW*) os="windows" ;;
        *)          os="unknown" ;;
    esac
    
    case "$(uname -m)" in
        x86_64)     arch="amd64" ;;
        arm64|aarch64) arch="arm64" ;;
        *)          arch="unknown" ;;
    esac
    
    echo "${os}-${arch}"
}

# Download and install
platform=$(detect_platform)
echo "Detected platform: $platform"
echo "Downloading Drop client..."

mkdir -p "$INSTALL_DIR"

if command -v curl >/dev/null 2>&1; then
    curl -L "$BASE_URL/binaries/$platform" -o "$INSTALL_DIR/$BINARY_NAME"
elif command -v wget >/dev/null 2>&1; then
    wget -O "$INSTALL_DIR/$BINARY_NAME" "$BASE_URL/binaries/$platform"
else
    echo "Error: Neither curl nor wget found. Please install one of them."
    exit 1
fi

chmod +x "$INSTALL_DIR/$BINARY_NAME"

# Add to PATH if not already there
if [[ ":$PATH:" != *":$INSTALL_DIR:"* ]]; then
    echo "Adding $INSTALL_DIR to PATH..."
    case "$SHELL" in
        */bash) echo 'export PATH="$PATH:'$INSTALL_DIR'"' >> "$HOME/.bashrc" ;;
        */zsh) echo 'export PATH="$PATH:'$INSTALL_DIR'"' >> "$HOME/.zshrc" ;;
        *) echo 'export PATH="$PATH:'$INSTALL_DIR'"' >> "$HOME/.profile" ;;
    esac
    echo "Please run 'source ~/.bashrc' (or ~/.zshrc) or restart your terminal."
fi

echo "Installation completed! You can now use 'drop' command."
echo "Try: drop --help"
